version: '2'
services:
  authelia:
    image: node:7-alpine
    command: node /usr/src/dist/src/server/index.js /etc/authelia/config.yml
    volumes:
      - ./:/usr/src
      - ./test/integration/config.yml:/etc/authelia/config.yml:ro
    networks:
      - example-network

  int-test:
    build: ./test/integration
    command: ./node_modules/.bin/mocha --compilers ts:ts-node/register --recursive test/integration
    volumes:
      - ./:/usr/src
    networks:
      - example-network


  nginx:
    image: nginx:alpine
    volumes:
      - ./example/nginx/index.html:/usr/share/nginx/html/index.html
      - ./example/nginx/secret.html:/usr/share/nginx/html/secret.html
      - ./example/nginx/ssl:/etc/ssl
      - ./test/integration/nginx.conf:/etc/nginx/nginx.conf
    expose:
      - "8080"
    depends_on:
      - authelia
    networks:
      example-network:
        aliases:
          - home.test.local
          - secret.test.local
          - secret1.test.local
          - secret2.test.local
          - mx1.mail.test.local
          - mx2.mail.test.local
          - auth.test.local


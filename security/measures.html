<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Security Measures - Authelia</title> <link rel="shortcut icon" href="/docs/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/docs/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-124926127-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-124926127-1'); </script> <script type="text/javascript" src="/docs/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/docs/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Security Measures | Authelia</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Security Measures" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Authelia is an open source multi-factor single sign-on portal for web applications" /> <meta property="og:description" content="Authelia is an open source multi-factor single sign-on portal for web applications" /> <meta property="og:site_name" content="Authelia" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Security Measures" /> <script type="application/ld+json"> {"headline":"Security Measures","description":"Authelia is an open source multi-factor single sign-on portal for web applications","url":"/docs/security/measures.html","@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/docs/images/authelia-title.png"}},"@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css" /> </head> <body> <a class="github-fork-ribbon" href="https://github.com/authelia/authelia" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/docs/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/" class="nav-list-link">Home</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/home/architecture.html" class="nav-list-link">Architecture</a></li></ul></li><li class="nav-list-item"><a href="/docs/getting-started.html" class="nav-list-link">Getting Started</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/features/" class="nav-list-link">Features</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/features/first-factor.html" class="nav-list-link">First Factor</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/features/2fa/" class="nav-list-link">Second Factor</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/features/2fa/one-time-password.html" class="nav-list-link">Time-based One-Time Password</a> </li><li class="nav-list-item "> <a href="/docs/features/2fa/security-key.html" class="nav-list-link">Security Keys</a> </li><li class="nav-list-item "> <a href="/docs/features/2fa/push-notifications.html" class="nav-list-link">Push Notification</a> </li></ul></li><li class="nav-list-item "><a href="/docs/features/single-factor.html" class="nav-list-link">Single Factor</a></li><li class="nav-list-item "><a href="/docs/features/password-reset.html" class="nav-list-link">Password Reset</a></li><li class="nav-list-item "><a href="/docs/features/access-control.html" class="nav-list-link">Access Control</a></li><li class="nav-list-item "><a href="/docs/features/regulation.html" class="nav-list-link">Regulation</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/configuration/" class="nav-list-link">Configuration</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/configuration/access-control.html" class="nav-list-link">Access Control</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/configuration/authentication/" class="nav-list-link">Authentication backends</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/configuration/authentication/file.html" class="nav-list-link">File</a> </li><li class="nav-list-item "> <a href="/docs/configuration/authentication/ldap.html" class="nav-list-link">LDAP</a> </li></ul></li><li class="nav-list-item "><a href="/docs/configuration/duo-push-notifications.html" class="nav-list-link">Duo Push Notifications</a></li><li class="nav-list-item "><a href="/docs/configuration/miscellaneous.html" class="nav-list-link">Miscellaneous</a></li><li class="nav-list-item "><a href="/docs/configuration/one-time-password.html" class="nav-list-link">Time-based One-Time Password</a></li><li class="nav-list-item "><a href="/docs/configuration/regulation.html" class="nav-list-link">Regulation</a></li><li class="nav-list-item "><a href="/docs/configuration/secrets.html" class="nav-list-link">Secrets</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/configuration/notifier/" class="nav-list-link">Notifier</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/configuration/notifier/filesystem.html" class="nav-list-link">Filesystem</a> </li><li class="nav-list-item "> <a href="/docs/configuration/notifier/smtp.html" class="nav-list-link">SMTP</a> </li></ul></li><li class="nav-list-item "><a href="/docs/configuration/server.html" class="nav-list-link">Server</a></li><li class="nav-list-item "><a href="/docs/configuration/session.html" class="nav-list-link">Session</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/configuration/storage/" class="nav-list-link">Storage backends</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/configuration/storage/mariadb.html" class="nav-list-link">MariaDB</a> </li><li class="nav-list-item "> <a href="/docs/configuration/storage/mysql.html" class="nav-list-link">MySQL</a> </li><li class="nav-list-item "> <a href="/docs/configuration/storage/postgres.html" class="nav-list-link">PostgreSQL</a> </li><li class="nav-list-item "> <a href="/docs/configuration/storage/sqlite.html" class="nav-list-link">SQLite</a> </li></ul></li><li class="nav-list-item "><a href="/docs/configuration/theme.html" class="nav-list-link">Theme</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/deployment/" class="nav-list-link">Deployment</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/deployment/deployment-lite.html" class="nav-list-link">Deployment - Lite</a></li><li class="nav-list-item "><a href="/docs/deployment/deployment-ha.html" class="nav-list-link">Deployment - Highly-Available</a></li><li class="nav-list-item "><a href="/docs/deployment/deployment-kubernetes.html" class="nav-list-link">Deployment - Kubernetes</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/deployment/supported-proxies/" class="nav-list-link">Proxy Integration</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/deployment/supported-proxies/haproxy.html" class="nav-list-link">HAProxy</a> </li><li class="nav-list-item "> <a href="/docs/deployment/supported-proxies/nginx.html" class="nav-list-link">Nginx</a> </li><li class="nav-list-item "> <a href="/docs/deployment/supported-proxies/traefik1.x.html" class="nav-list-link">Traefik 1.x</a> </li><li class="nav-list-item "> <a href="/docs/deployment/supported-proxies/traefik2.x.html" class="nav-list-link">Traefik 2.x</a> </li></ul></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/security/" class="nav-list-link">Security</a><ul class="nav-list "><li class="nav-list-item active"><a href="/docs/security/measures.html" class="nav-list-link active">Security Measures</a></li><li class="nav-list-item "><a href="/docs/security/threat-model.html" class="nav-list-link">Threat Model</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/contributing/" class="nav-list-link">Contributing</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/contributing/build-and-dev.html" class="nav-list-link">Build & Dev</a></li><li class="nav-list-item "><a href="/docs/contributing/authelia-scripts.html" class="nav-list-link">Authelia Scripts</a></li><li class="nav-list-item "><a href="/docs/contributing/commitmsg-guidelines.html" class="nav-list-link">Commit Message Guidelines</a></li><li class="nav-list-item "><a href="/docs/contributing/suites.html" class="nav-list-link">Suites</a></li></ul></li><li class="nav-list-item"><a href="/docs/faq.html" class="nav-list-link">FAQ</a></li><li class="nav-list-item"><a href="/docs/roadmap.html" class="nav-list-link">Roadmap</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/community/" class="nav-list-link">Community</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/community/two-factor-basic-auth.html" class="nav-list-link">2FA through basic auth</a></li><li class="nav-list-item "><a href="/docs/community/using-remote-user-header-for-sso-with-jira.html" class="nav-list-link">Using Remote-User header for SSO with Jira</a></li><li class="nav-list-item "><a href="/docs/community/additional-resources.html" class="nav-list-link">Miscellaneous Additional Resources</a></li><li class="nav-list-item "><a href="/docs/community/example-of-authelia-lite-on-docker-swarm.html" class="nav-list-link">Example of authelia lite on docker swarm</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Authelia" aria-label="Search Authelia" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="">Security</a></li> <li class="breadcrumb-nav-list-item"><span>Security Measures</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="security-measures"> <a href="#security-measures" class="anchor-heading" aria-labelledby="security-measures"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Security Measures </h1> <h2 id="protection-against-cookie-theft"> <a href="#protection-against-cookie-theft" class="anchor-heading" aria-labelledby="protection-against-cookie-theft"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Protection against cookie theft </h2> <p>Authelia uses two mechanisms to protect against cookie theft:</p> <ol> <li>session attribute <code class="language-plaintext highlighter-rouge">httpOnly</code> set to true make client-side code unable to read the cookie.</li> <li>session attribute <code class="language-plaintext highlighter-rouge">secure</code> ensure the cookie will never be sent over an insecure HTTP connections.</li> </ol> <h2 id="protection-against-multi-domain-cookie-attacks"> <a href="#protection-against-multi-domain-cookie-attacks" class="anchor-heading" aria-labelledby="protection-against-multi-domain-cookie-attacks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Protection against multi-domain cookie attacks </h2> <p>Since Authelia uses multi-domain cookies to perform single sign-on, an attacker who poisoned a user’s DNS cache can easily retrieve the user’s cookies by making the user send a request to one of the attacker’s IPs.</p> <p>To mitigate this risk, it’s advisable to only use HTTPS connections with valid certificates and enforce it with HTTP Strict Transport Security (<a href="https://www.nginx.com/blog/http-strict-transport-security-hsts-and-nginx/">HSTS</a>) so that the attacker must also require the certificate to retrieve the cookies.</p> <p>Note that using <a href="https://www.nginx.com/blog/http-strict-transport-security-hsts-and-nginx/">HSTS</a> has consequences. That’s why you should read the blog post nginx has written on <a href="https://www.nginx.com/blog/http-strict-transport-security-hsts-and-nginx/">HSTS</a>.</p> <h2 id="protection-against-username-enumeration"> <a href="#protection-against-username-enumeration" class="anchor-heading" aria-labelledby="protection-against-username-enumeration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Protection against username enumeration </h2> <p>Authelia adaptively delays authentication attempts based on the mean (average) of the previous 10 successful attempts, and a small random interval to make it even harder to determine if the attempt was successful. On start it is assumed that the last 10 attempts took 1000ms, this quickly grows or shrinks to the correct value over time regardless of the authentication backend.</p> <p>The cost of this is low since in the instance of a user not existing it just sleeps to delay the login. Lastly the absolute minimum time authentication can take is 250ms. Both of these measures also have the added effect of creating an additional delay for all authentication attempts reducing the likelihood a password can be brute-forced even if regulation settings are too permissive.</p> <h2 id="protections-against-password-cracking-file-authentication-provider"> <a href="#protections-against-password-cracking-file-authentication-provider" class="anchor-heading" aria-labelledby="protections-against-password-cracking-file-authentication-provider"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Protections against password cracking (File authentication provider) </h2> <p>Authelia implements a variety of measures to prevent an attacker cracking passwords if they somehow obtain the file used by the file authentication provider, this is unrelated to LDAP auth.</p> <p>First and foremost Authelia only uses very secure hashing algorithms with sane and secure defaults. The first and default hashing algorithm we use is Argon2id which is currently considered the most secure hashing algorithm. We also support SHA512, which previously was the default.</p> <p>Secondly Authelia uses salting with all hashing algorithms. These salts are generated with a random string generator, which is seeded every time it’s used by a cryptographically secure 1024bit prime number. This ensures that even if an attacker obtains the file, each password has to be brute forced individually.</p> <p>Lastly Authelia’s implementation of Argon2id is highly tunable. You can tune the key length, salt used, iterations (time), parallelism, and memory usage. To read more about this please read how to <a href="/docs/configuration/authentication/file.html">configure</a> file authentication.</p> <h2 id="user-profile-and-group-membership-always-kept-up-to-date-ldap-authentication-provider"> <a href="#user-profile-and-group-membership-always-kept-up-to-date-ldap-authentication-provider" class="anchor-heading" aria-labelledby="user-profile-and-group-membership-always-kept-up-to-date-ldap-authentication-provider"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> User profile and group membership always kept up-to-date (LDAP authentication provider) </h2> <p>Authelia by default refreshes the user’s profile and membership every 5 minutes. Additionally, it will invalidate any session where the user could not be retrieved from LDAP based on the user filter, for example if they were deleted or disabled provided the user filter is set correctly. These updates occur when a user accesses a resource protected by Authelia.</p> <p>These protections can be <a href="/docs/configuration/authentication/ldap.html">tuned</a> according to your security policy by changing refresh_interval, however we believe that 5 minutes is a fairly safe interval.</p> <h2 id="notifier-security-measures-smtp"> <a href="#notifier-security-measures-smtp" class="anchor-heading" aria-labelledby="notifier-security-measures-smtp"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Notifier security measures (SMTP) </h2> <p>By default the SMTP Notifier implementation does not allow connections that are not secure. As such all connections require the following:</p> <ol> <li>TLS Connection (STARTTLS or SMTPS) has been negotiated before authentication or sending emails (unauthenticated connections require it as well)</li> <li>Valid X509 Certificate presented to the client during the TLS handshake</li> </ol> <p>There is an option to disable both of these security measures however they are not recommended. You should only do this in a situation where you control all networks between Authelia and the SMTP server. The following configuration options exist to configure the security level:</p> <h3 id="smtps-vs-starttls"> <a href="#smtps-vs-starttls" class="anchor-heading" aria-labelledby="smtps-vs-starttls"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SMTPS vs STARTTLS </h3> <p>By default all connections start as plain text and are upgraded via STARTTLS. SMTPS is supported, however due to the fact it was basically considered deprecated before the turn of the century, there is no way to configure it. It happens automatically when a SMTP notifier is configured with the SMTPS port of 465.</p> <h3 id="configuration-option-disable_verify_cert"> <a href="#configuration-option-disable_verify_cert" class="anchor-heading" aria-labelledby="configuration-option-disable_verify_cert"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuration Option: disable_verify_cert </h3> <p>This is a YAML boolean type (true/false, y/n, 1/0, etc). This disables the X509 PKI verification mechanism. We recommend using the trusted_cert option over this, as disabling this security feature makes you vulnerable to MITM attacks.</p> <h3 id="configuration-option-disable_require_tls"> <a href="#configuration-option-disable_require_tls" class="anchor-heading" aria-labelledby="configuration-option-disable_require_tls"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuration Option: disable_require_tls </h3> <p>This is a YAML boolean type (true/false, y/n, 1/0, etc). This disables the requirement that all connections must be over TLS. This is only usable currently with authentication disabled (comment the password) and as such is only an option for SMTP servers that allow unauthenticated relay (bad practice).</p> <h3 id="configuration-option-trusted_cert"> <a href="#configuration-option-trusted_cert" class="anchor-heading" aria-labelledby="configuration-option-trusted_cert"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuration Option: trusted_cert </h3> <p>This is a YAML string type. This specifies the file location of a pub certificate that can be used to validate the authenticity of a server with a self signed certificate. This can either be the public cert of the certificate authority used to sign the certificate or the public key itself. They must be in the PEM format. The certificate is added in addition to the certificates trusted by the host machine. If the certificate is invalid, inaccessible, or is otherwise not configured; Authelia just uses the hosts certificates.</p> <h3 id="explanation"> <a href="#explanation" class="anchor-heading" aria-labelledby="explanation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Explanation </h3> <p>There are a few reasons for the security measures implemented:</p> <ol> <li>Transmitting username’s and passwords over plain-text is an obvious vulnerability</li> <li>The emails generated by Authelia, if transmitted in plain-text could allow an attacker to intercept a link used to setup 2FA; which reduces security</li> <li>Not validating the identity of the server allows man-in-the-middle attacks</li> </ol> <h2 id="additional-security"> <a href="#additional-security" class="anchor-heading" aria-labelledby="additional-security"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Additional security </h2> <h3 id="reset-password"> <a href="#reset-password" class="anchor-heading" aria-labelledby="reset-password"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Reset Password </h3> <p>It’s possible to disable the reset password functionality and is recommended for anyone wanting to increase security. See the <a href="/docs/configuration/authentication/">configuration</a> for information.</p> <h3 id="session-security"> <a href="#session-security" class="anchor-heading" aria-labelledby="session-security"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Session security </h3> <p>We have a few options to configure the security of a session. The main and most important one is the session secret. This is used to encrypt the session data when when stored in the Redis key value database. This should be as random as possible.</p> <p>Additionally you can configure the validity period of sessions. For example in a highly security conscious domain you would probably want to set the session remember_me_duration to 0 to disable this feature, and set an expiration of something like 2 hours and inactivity of 10 minutes. This means the hard limit or the time the session will be destroyed no matter what is 2 hours, and the soft limit or the time a user can be inactive for is 10 minutes.</p> <h3 id="additional-proxy-protection-measures"> <a href="#additional-proxy-protection-measures" class="anchor-heading" aria-labelledby="additional-proxy-protection-measures"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Additional proxy protection measures </h3> <p>You can also apply the following headers to your proxy configuration for improving security. Please read the documentation of those headers before applying them blindly.</p> <h4 id="nginx"> <a href="#nginx" class="anchor-heading" aria-labelledby="nginx"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> nginx </h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># We don't want any credentials / TOTP secret key / QR code to be cached by
# the client
add_header Cache-Control "no-store";
add_header Pragma "no-cache";

# Clickjacking / XSS protection

# We don't want Authelia's login page to be rendered within a &lt;frame&gt;,
# &lt;iframe&gt; or &lt;object&gt; from an external website.
add_header X-Frame-Options "SAMEORIGIN";

# Block pages from loading when they detect reflected XSS attacks.
add_header X-XSS-Protection "1; mode=block";
</code></pre></div></div> <h4 id="traefik-2x---kubernetes-crd"> <a href="#traefik-2x---kubernetes-crd" class="anchor-heading" aria-labelledby="traefik-2x---kubernetes-crd"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Traefik 2.x - Kubernetes CRD </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">traefik.containo.us/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Middleware</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">headers-authelia</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">headers</span><span class="pi">:</span>
    <span class="na">browserXssFilter</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">customFrameOptionsValue</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SAMEORIGIN"</span>
    <span class="na">customResponseHeaders</span><span class="pi">:</span>
      <span class="na">Cache-Control</span><span class="pi">:</span> <span class="s2">"</span><span class="s">no-store"</span>
      <span class="na">Pragma</span><span class="pi">:</span> <span class="s2">"</span><span class="s">no-cache"</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">traefik.containo.us/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">IngressRoute</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">authelia</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">entryPoints</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">http</span>
  <span class="na">routes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">match</span><span class="pi">:</span> <span class="s">Host(`auth.example.com`) &amp;&amp; PathPrefix(`/`)</span>
      <span class="na">kind</span><span class="pi">:</span> <span class="s">Rule</span>
      <span class="na">priority</span><span class="pi">:</span> <span class="m">1</span>
      <span class="na">middlewares</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">headers-authelia</span>
          <span class="na">namespace</span><span class="pi">:</span> <span class="s">authelia</span>
      <span class="na">services</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">authelia</span>
          <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
</code></pre></div></div> <h4 id="traefik-2x---docker-compose"> <a href="#traefik-2x---docker-compose" class="anchor-heading" aria-labelledby="traefik-2x---docker-compose"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Traefik 2.x - docker-compose </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">authelia</span><span class="pi">:</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.authelia.middlewares=authelia-headers"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.middlewares.authelia-headers.headers.browserXssFilter=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.middlewares.authelia-headers.headers.customFrameOptionsValue=SAMEORIGIN"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.middlewares.authelia-headers.headers.customResponseHeaders.Cache-Control=no-store"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.middlewares.authelia-headers.headers.customResponseHeaders.Pragma=no-cache"</span>
</code></pre></div></div> <h3 id="more-protections-measures-with-fail2ban"> <a href="#more-protections-measures-with-fail2ban" class="anchor-heading" aria-labelledby="more-protections-measures-with-fail2ban"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> More protections measures with fail2ban </h3> <p>If you are running fail2ban, adding a filter and jail for Authelia can reduce load on the application / web server. Fail2ban will ban IPs exceeding a threshold of repeated failed logins at the firewall level of your host.</p> <p>If you are using Docker, the Authelia log file location has to be mounted from the host system to the container for fail2ban to access it.</p> <p>Create a configuration file in the <code class="language-plaintext highlighter-rouge">filter.d</code> folder with the content below. In Debian-based systems the folder is typically located at <code class="language-plaintext highlighter-rouge">/etc/fail2ban/filter.d</code>.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Fail2Ban filter for Authelia

# Make sure that the HTTP header "X-Forwarded-For" received by Authelia's backend
# only contains a single IP address (the one from the end-user), and not the proxy chain
# (it is misleading: usually, this is the purpose of this header).

# the failregex rule counts every failed login (wrong username or password) and failed TOTP entry as a failure
# the ignoreregex rule ignores debug, info and warning messages as all authentication failures are flagged as level=error by Authelia

[Definition]
failregex = ^.*Error while checking password for.*remote_ip=&lt;HOST&gt; stack.*
            ^.*Credentials are wrong for user .*remote_ip=&lt;HOST&gt; stack.*
            ^.*Wrong passcode during TOTP validation.*remote_ip=&lt;HOST&gt; stack.*

ignoreregex = ^.*level=debug.*
              ^.*level=info.*
              ^.*level=warning.*
</code></pre></div></div> <p>Modify the <code class="language-plaintext highlighter-rouge">jail.local</code> file. In Debian-based systems the folder is typically located at <code class="language-plaintext highlighter-rouge">/etc/fail2ban/</code>. If the file does not exist, create it by copying the jail.conf <code class="language-plaintext highlighter-rouge">cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local</code>. Add an Authelia entry to the “Jails” section of the file:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[authelia]
enabled = true
port = http,https,9091
filter = authelia
logpath = /path-to-your-authelia.log
maxretry = 3
bantime = 1d
findtime = 1d
chain = DOCKER-USER
</code></pre></div></div> <p>If you are not using Docker remove the the line “chain = DOCKER-USER”</p> <p>Finally, restart the fail2ban service.</p> <h2 id="container-privilege-de-escalation"> <a href="#container-privilege-de-escalation" class="anchor-heading" aria-labelledby="container-privilege-de-escalation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Container privilege de-escalation </h2> <p>Authelia will run as root by default, there are two options to run as a non-root user. The first option is to use the Docker <code class="language-plaintext highlighter-rouge">--user</code> option on the command line or in docker-compose. The second option is to use the <code class="language-plaintext highlighter-rouge">PUID</code> and <code class="language-plaintext highlighter-rouge">PGID</code> environment variables. An added benefit of using the environment variables is the mounted volumes ownership will automatically be changed for you.</p> <h3 id="docker-user-option"> <a href="#docker-user-option" class="anchor-heading" aria-labelledby="docker-user-option"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Docker user option </h3> <p>With the Docker <code class="language-plaintext highlighter-rouge">--user</code> option, Docker will ensure Authelia is running as the user id and group id you specify. In order to use this option, you will need to mount the <code class="language-plaintext highlighter-rouge">/config</code> volume to a directory on the host and set the owner and group of that directory to the same user you supplied to docker. Running Authelia with <code class="language-plaintext highlighter-rouge">--user</code> without mounting a volume to <code class="language-plaintext highlighter-rouge">/config</code> or incorrectly setting the host systems directory owner will cause Authelia to exit immediately. The docker <code class="language-plaintext highlighter-rouge">--user</code> option will take precedence over the environment variables.</p> <p>On the command line, you would create your Authelia data directory, change ownership to your non-root user and run Authelia with <code class="language-plaintext highlighter-rouge">--user</code> set:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /authelia
chown user:group /authelia
docker run --user user:group -v /authelia:/config authelia/authelia:latest
</code></pre></div></div> <p>As a docker-compose.yml file:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '3.8'
services:
  authelia:
    image: authelia/authelia
    container_name: authelia
    user: 1000:1000
    volumes:
      - ./authelia:/config
</code></pre></div></div> <h3 id="puidpgid-environment-variables"> <a href="#puidpgid-environment-variables" class="anchor-heading" aria-labelledby="puidpgid-environment-variables"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> PUID/PGID environment variables </h3> <p>If you choose to use the environment variables, the correct ownership will be applied automatically on startup of the container, so there’s no need to <code class="language-plaintext highlighter-rouge">chown</code> before running, to use this on the command line use the following:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -e PUID=1000 -e PGID=1000 -v /authelia:/config authelia:authelia:latest
</code></pre></div></div> <p>As a docker-compose.yml file:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '3.8'
services:
  authelia:
    image: authelia/authelia
    container_name: authelia
    environment:
      PUID: 1000
      PGID: 1000
    volumes:
      - ./authelia:/config
</code></pre></div></div> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0">Copyright &copy; 2021 Authelia. Distributed by an <a href=\"https://github.com/authelia/authelia/blob/master/LICENSE\">Apache 2.0 license.</a> </p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
